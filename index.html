<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ò–¥–µ–∏</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f5f5f5; }
    input, button { margin: 5px; padding: 8px; }
    #adminPanel, #moderPanel, #codeSection { display: none; margin-top: 20px; }
  </style>
</head>
<body>

  <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è / –í—Ö–æ–¥</h2>
  <input type="email" id="email" placeholder="Email"><br>
  <input type="text" id="username" placeholder="–ò–º—è"><br>
  <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å"><br>
  <button onclick="register()">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
  <button onclick="login()">–í–æ–π—Ç–∏</button>

  <div id="codeSection">
    <hr>
    <input type="text" id="roleCode" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –¥–ª—è —Ä–æ–ª–∏">
    <button onclick="submitCode()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∫–æ–¥</button>
  </div>

  <div id="adminPanel">
    <h3>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</h3>
    <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, –ì–ª–∞–≤–Ω—ã–π –ê–¥–º–∏–Ω!</p>
    <a href="admin.html">–ü–µ—Ä–µ–π—Ç–∏ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</a>
  </div>

  <div id="moderPanel">
    <h3>–ü–∞–Ω–µ–ª—å –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞</h3>
    <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä!</p>
    <a href="moderator.html">–ü–µ—Ä–µ–π—Ç–∏ –≤ –ø–∞–Ω–µ–ª—å –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞</a>
  </div>

  <script type="module">
    // –í–°–¢–ê–í–¨ –°–í–û–ò –î–ê–ù–ù–´–ï –û–¢ FIREBASE –°–Æ–î–ê üëá
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "–í–°–¢–ê–í–¨_–°–Æ–î–ê",
      authDomain: "–í–°–¢–ê–í–¨",
      projectId: "–í–°–¢–ê–í–¨",
      storageBucket: "–í–°–¢–ê–í–¨",
      messagingSenderId: "–í–°–¢–ê–í–¨",
      appId: "–í–°–¢–ê–í–¨"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
    const db = getFirestore();

    const codeSection = document.getElementById("codeSection");
    const adminPanel = document.getElementById("adminPanel");
    const moderPanel = document.getElementById("moderPanel");

    async function register() {
      const email = emailInput.value;
      const pass = password.value;
      const username = document.getElementById("username").value;

      try {
        const userCred = await createUserWithEmailAndPassword(auth, email, pass);
        await setDoc(doc(db, "users", userCred.user.uid), {
          email: email,
          username: username,
          role: "user"
        });
        alert("–£—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω!");
        codeSection.style.display = "block";
      } catch (err) {
        alert("–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: " + err.message);
      }
    }

    async function login() {
      const email = emailInput.value;
      const pass = password.value;

      try {
        const userCred = await signInWithEmailAndPassword(auth, email, pass);
        const userDoc = await getDoc(doc(db, "users", userCred.user.uid));
        const role = userDoc.exists() ? userDoc.data().role : "user";

        if (role === "admin") {
          adminPanel.style.display = "block";
        } else if (role === "moderator") {
          moderPanel.style.display = "block";
        } else {
          codeSection.style.display = "block";
        }
      } catch (err) {
        alert("–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: " + err.message);
      }
    }

    async function submitCode() {
      const code = document.getElementById("roleCode").value.trim();
      const user = auth.currentUser;
      if (!user) return alert("–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç.");

      let role = "";
      if (code === "admin99") role = "admin";
      else if (code === "moder98") role = "moderator";
      else return alert("–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥");

      try {
        await setDoc(doc(db, "users", user.uid), {
          email: user.email,
          username: user.displayName || "",
          role: role
        });
        alert("–¢–µ–ø–µ—Ä—å –≤—ã " + (role === "admin" ? "–ê–¥–º–∏–Ω!" : "–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä!"));
        window.location.reload();
      } catch (err) {
        alert("–û—à–∏–±–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è —Ä–æ–ª–∏: " + err.message);
      }
    }

    const emailInput = document.getElementById("email");
    const password = document.getElementById("password");
  </script>
</body>
</html>
